{
  "info": {
    "name": "Ega Bank API - minimal",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Create Client",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"}],
        "body": {"mode":"raw","raw":"{\n  \"firstName\": \"Alice\",\n  \"lastName\": \"Dupont\",\n  \"birthDate\": \"1990-01-01\",\n  \"gender\": \"F\",\n  \"address\": \"1 rue Test\",\n  \"phone\": \"+33123456789\",\n  \"email\": \"alice@example.com\",\n  \"nationality\": \"FR\"\n}"},
        "url": {"raw":"http://localhost:8080/api/clients","protocol":"http","host":["localhost"],"port":"8080","path":["api","clients"]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Create Client - status 200', function () { pm.response.to.have.status(200); });",
              "var json = pm.response.json();",
              "if (json && json.id) { pm.environment.set('clientId', json.id); }"
            ]
          }
        }
      ]
    },
    {
      "name": "Register",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"}],
        "body": {"mode":"raw","raw":"{\n  \"username\": \"user1\",\n  \"password\": \"pass\"\n}"},
        "url": {"raw":"http://localhost:8080/api/auth/register","protocol":"http","host":["localhost"],"port":"8080","path":["api","auth","register"]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Register - status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Login",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"}],
        "body": {"mode":"raw","raw":"{\n  \"username\": \"user1\",\n  \"password\": \"pass\"\n}"},
        "url": {"raw":"http://localhost:8080/api/auth/login","protocol":"http","host":["localhost"],"port":"8080","path":["api","auth","login"]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Login - status 200', function () { pm.response.to.have.status(200); });",
              "var json = pm.response.json();",
              "pm.test('token present', function () { pm.expect(json.token).to.be.a('string'); });",
              "pm.environment.set('token', 'Bearer ' + json.token);"
            ]
          }
        }
      ]
    }
    ,
    {
      "name": "Create Account",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"{{token}}"}],
        "body": {"mode":"raw","raw":"{\n  \"clientId\": 1,\n  \"type\": \"SAVINGS\"\n}"},
        "url": {"raw":"http://localhost:8080/api/accounts","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts"]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Create Account - status 200', function () { pm.response.to.have.status(200); });",
              "var json = pm.response.json();",
              "if (json && json.accountNumber) { pm.environment.set('accountNumber', json.accountNumber); }"
            ]
          }
        }
      ]
    },
    {
      "name": "Deposit",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"{{token}}"}],
        "body": {"mode":"raw","raw":"{\n  \"amount\": 100.0\n}"},
        "url": {"raw":"http://localhost:8080/api/accounts/{{accountNumber}}/deposit","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts","{{accountNumber}}","deposit"]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Deposit - status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Withdraw",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"{{token}}"}],
        "body": {"mode":"raw","raw":"{\n  \"amount\": 50.0\n}"},
        "url": {"raw":"http://localhost:8080/api/accounts/{{accountNumber}}/withdraw","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts","{{accountNumber}}","withdraw"]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Withdraw - status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Withdraw (Insufficient)",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"{{token}}"}],
        "body": {"mode":"raw","raw":"{\n  \"amount\": 1000000.0\n}"},
        "url": {"raw":"http://localhost:8080/api/accounts/{{accountNumber}}/withdraw","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts","{{accountNumber}}","withdraw"]}
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Withdraw Insufficient - status 400', function () { pm.response.to.have.status(400); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Transfer",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"{{token}}"}],
        "body": {"mode":"raw","raw":"{\n  \"fromAccount\": \"{{accountNumber}}\",\n  \"toAccount\": \"{{otherAccount}}\",\n  \"amount\": 10.0\n}"},
        "url": {"raw":"http://localhost:8080/api/accounts/transfer","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts","transfer"]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Transfer - status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Transfer (Insufficient)",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"{{token}}"}],
        "body": {"mode":"raw","raw":"{\n  \"fromAccount\": \"{{accountNumber}}\",\n  \"toAccount\": \"{{otherAccount}}\",\n  \"amount\": 1000000.0\n}"},
        "url": {"raw":"http://localhost:8080/api/accounts/transfer","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts","transfer"]}
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Transfer Insufficient - status 400', function () { pm.response.to.have.status(400); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Get Transactions",
      "request": {
        "method": "GET",
        "header": [{"key":"Authorization","value":"{{token}}"}],
        "url": {"raw":"http://localhost:8080/api/accounts/{{accountNumber}}/transactions?start=2025-01-01T00:00:00&end=2026-12-31T23:59:59","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts","{{accountNumber}}","transactions"],"query":[{"key":"start","value":"2025-01-01T00:00:00"},{"key":"end","value":"2026-12-31T23:59:59"}]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Get Transactions - status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Get Statement (CSV)",
      "request": {
        "method": "GET",
        "header": [{"key":"Authorization","value":"{{token}}"}],
        "url": {"raw":"http://localhost:8080/api/accounts/{{accountNumber}}/statement?start=2025-01-01T00:00:00&end=2026-12-31T23:59:59","protocol":"http","host":["localhost"],"port":"8080","path":["api","accounts","{{accountNumber}}","statement"],"query":[{"key":"start","value":"2025-01-01T00:00:00"},{"key":"end","value":"2026-12-31T23:59:59"}]}
      }
      ,
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Get Statement - status 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Content is CSV', function() { pm.response.to.have.header('Content-Disposition'); });"
            ]
          }
        }
      ]
    }
  ]
}
